<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spaktok Live Stream</title>
    <style>
        body { font-family: Arial, sans-serif; display: flex; flex-direction: column; align-items: center; margin-top: 20px; }
        #videoPlayer { width: 80%; max-width: 800px; border: 1px solid #ccc; }
        #chatBox { width: 80%; max-width: 800px; height: 300px; border: 1px solid #ccc; margin-top: 20px; overflow-y: scroll; padding: 10px; }
        #messageInput { width: calc(80% - 100px); max-width: 700px; padding: 10px; margin-top: 10px; }
        #sendButton { width: 90px; padding: 10px; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>Spaktok Live Stream Test</h1>
    <video id="videoPlayer" controls autoplay muted>
        <source src="/streaming/video" type="video/mp4">
        متصفحك لا يدعم تشغيل الفيديو.
    </video>

    <div id="chatBox"></div>
    <input type="text" id="messageInput" placeholder="اكتب رسالتك هنا...">
    <button id="sendButton">إرسال</button>

    <script>
        const videoPlayer = document.getElementById("videoPlayer");
        const chatBox = document.getElementById("chatBox");
        const messageInput = document.getElementById("messageInput");
        const sendButton = document.getElementById("sendButton");

        // WebSocket connection
        const ws = new WebSocket(`ws://${window.location.hostname}:5000`); // Assuming backend is on port 5000

        ws.onopen = () => {
            console.log("Connected to WebSocket server");
            chatBox.innerHTML += `<p><em>متصل بخادم الدردشة.</em></p>`;
        };

        ws.onmessage = (event) => {
            const message = event.data;
            chatBox.innerHTML += `<p><strong>آخر:</strong> ${message}</p>`;
            chatBox.scrollTop = chatBox.scrollHeight; // Scroll to bottom
        };

        ws.onclose = () => {
            console.log("Disconnected from WebSocket server");
            chatBox.innerHTML += `<p><em>تم قطع الاتصال بخادم الدردشة.</em></p>`;
        };

        ws.onerror = (error) => {
            console.error("WebSocket error:", error);
            chatBox.innerHTML += `<p style="color: red;"><em>خطأ في الاتصال بالدردشة.</em></p>`;
        };

        sendButton.addEventListener("click", () => {
            const message = messageInput.value;
            if (message) {
                ws.send(message);
                chatBox.innerHTML += `<p><strong>أنت:</strong> ${message}</p>`;
                messageInput.value = "";
                chatBox.scrollTop = chatBox.scrollHeight; // Scroll to bottom
            }
        });

        messageInput.addEventListener("keypress", (event) => {
            if (event.key === "Enter") {
                sendButton.click();
            }
        });
    </script>
</body>
</html>

